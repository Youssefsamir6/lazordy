{% extends 'base.html' %}
{% load i18n %} {# Keep this, it's essential for Django's i18n #}

{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-6">

    <div class="flex justify-end mb-4">
        {# This button will ideally link to Django's set_language view to actually change the language #}
        {# Example: <form action="{% url 'set_language' %}" method="post"> {% csrf_token %} <input name="next" type="hidden" value="{{ request.path }}"> <select name="language" onchange="this.form.submit()"> <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>ðŸ‡¬ðŸ‡§ English</option> <option value="ar" {% if LANGUAGE_CODE == 'ar' %}selected{% endif %}>ðŸ‡¸ðŸ‡¦ Arabic</option> </select> </form> #}
        {# OR, if you want a simple toggle button that POSTs to set_language #}
        {% get_current_language as CURRENT_LANGUAGE %}
        <form action="{% url 'set_language' %}" method="post">
            {% csrf_token %}
            <input name="next" type="hidden" value="{{ request.path }}">
            <input type="hidden" name="language" value="{% if CURRENT_LANGUAGE == 'ar' %}en{% else %}ar{% endif %}">
            <button type="submit" id="langToggle" class="px-4 py-2 bg-black text-white rounded hover:bg-gray-800 transition">
                {% if CURRENT_LANGUAGE == 'ar' %}ðŸ‡¬ðŸ‡§ English{% else %}ðŸ‡¸ðŸ‡¦ Arabic{% endif %}
            </button>
        </form>
    </div>


    <div class="bg-white dark:bg-gray-900 p-6 rounded shadow text-left">
        <h1 class="text-2xl font-bold mb-4">{% trans "Invoice Details" %}</h1> {# Using trans #}

        <div class="mb-6">
            <p class="text-sm">
                {% blocktrans with company_name=invoice.company_name %}Company: {{ company_name }}{% endblocktrans %} {# Using blocktrans #}
            </p>
            <p class="text-sm">
                {% blocktrans with company_address=invoice.company_address %}Address: {{ company_address }}{% endblocktrans %} {# Using blocktrans #}
            </p>
            <p class="text-sm">
                {% blocktrans with company_phone=invoice.company_phone %}Phone: {{ company_phone }}{% endblocktrans %} {# Using blocktrans #}
            </p>
        </div>

        <div class="mb-6">
            <p class="text-sm">
                {% blocktrans with invoice_number=invoice.invoice_number %}Invoice #: {{ invoice_number }}{% endblocktrans %} {# Using blocktrans #}
            </p>
            <p class="text-sm">
                {% blocktrans with date=invoice.date %}Date: {{ date }}{% endblocktrans %} {# Using blocktrans #}
            </p>
        </div>

        <div class="overflow-x-auto mb-6">
            <table class="min-w-full table-auto border-collapse border border-gray-300 dark:border-gray-700">
                <thead>
                    <tr class="bg-gray-200 dark:bg-gray-800">
                        <th class="px-4 py-2 border">{% trans "Product" %}</th> {# Using trans #}
                        <th class="px-4 py-2 border">{% trans "Quantity" %}</th> {# Using trans #}
                        <th class="px-4 py-2 border">{% trans "Unit Price" %}</th> {# Using trans #}
                        <th class="px-4 py-2 border">{% trans "Total" %}</th> {# Using trans #}
                    </tr>
                </thead>
                <tbody>
                    {% for item in invoice.items.all %}
                    <tr>
                        <td class="px-4 py-2 border">{{ item.product.name }}</td>
                        <td class="px-4 py-2 border">{{ item.quantity }}</td>
                        <td class="px-4 py-2 border">{{ item.unit_price }}</td>
                        <td class="px-4 py-2 border">{{ item.total_price }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="text-sm mb-6">
            <p>
                {% blocktrans with subtotal=invoice.subtotal %}Subtotal: {{ subtotal }}{% endblocktrans %} {# Using blocktrans #}
            </p>
            <p>
                {% blocktrans with total=invoice.total %}Total: {{ total }}{% endblocktrans %} {# Using blocktrans #}
            </p>
            <p>
                {% blocktrans with paid_amount=invoice.paid_amount %}Paid: {{ paid_amount }}{% endblocktrans %} {# Using blocktrans #}
            </p>
            <p>
                {% blocktrans with remaining_amount=invoice.remaining_amount %}Remaining: {{ remaining_amount }}{% endblocktrans %} {# Using blocktrans #}
            </p>
        </div>

        {% if invoice.qr_code %}
        <div class="mt-6">
            <p class="mb-2 font-medium">{% trans "Scan to view invoice:" %}</p> {# Using trans #}
            <img src="{{ invoice.qr_code.url }}" alt="{% trans 'QR Code' %}" class="w-40 h-40"> {# Alt text translatable #}
        </div>
        {% endif %}

        {% if invoice.pdf_file %}
        <div class="mt-6">
            <a href="{{ invoice.pdf_file.url }}" target="_blank" class="text-blue-600 hover:underline">
                {% trans "Download PDF" %} {# Using trans #}
            </a>
        </div>
        {% endif %}

    </div>
</div>

{# The JavaScript for the language toggle is no longer needed in this form,
   as Django's set_language view and middleware handle it server-side.
   I've included a Django-compatible button above.
#}
{% endblock %}